<!DOCTYPE html>
<html>
<head>
<title>Cloud Cost-Aware Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { font-family: Arial; background: #eef1f5; margin: 20px; }
.card {
    background:white;padding:15px;margin:10px;
    border-radius:10px;display:inline-block;width:250px;
    box-shadow:0 3px 8px rgba(0,0,0,0.1);
}
.alert {
    background:#fff3cd;padding:10px;
    border-left:5px solid #ffc107;
    margin-bottom:15px;display:none;
}
canvas { max-width:900px;margin-bottom:40px; }
</style>
</head>

<body>

<h1>Cloud Cost-Aware Dashboard</h1>

<div id="alertBox" class="alert"></div>

<select id="projectSelect" onchange="loadData()"></select>

<div class="card"><p id="cpu"></p></div>
<div class="card"><p id="mem"></p></div>
<div class="card"><p id="instances"></p></div>
<div class="card"><p id="traffic"></p></div>

<div class="card"><p id="region"></p></div>
<div class="card"><p id="status"></p></div>

<h2>CPU Trend</h2>
<canvas id="cpuChart"></canvas>

<h2>Daily Cost Trend</h2>
<canvas id="costChart"></canvas>

<h2>Scaling vs Cost</h2>
<canvas id="scaleCostChart"></canvas>

<script>
let cpuData=[],costData=[],instData=[];

function alertMsg(msg){
 let box=document.getElementById("alertBox");
 box.innerHTML=msg;box.style.display="block";
}

async function loadProjects(){
 const r=await fetch("data/projects.json");
 const ps=await r.json();
 let s=document.getElementById("projectSelect");
 s.innerHTML="";
 ps.forEach(p=>{
   let o=document.createElement("option");
   o.value=p;o.text=p;s.appendChild(o);
 });
 loadData();
}

async function loadData(){
 let p=document.getElementById("projectSelect").value;
 let r=await fetch("data/"+p+".json");
 let d=await r.json();

 document.getElementById("cpu").innerText="CPU: "+d.cpu+"%";
 document.getElementById("mem").innerText="Memory: "+d.memory+"%";
 document.getElementById("instances").innerText="Instances: "+d.instances;
 document.getElementById("traffic").innerText="Traffic: "+d.traffic;
 document.getElementById("region").innerText="Region: "+d.current_region;
 document.getElementById("status").innerText=d.status;

 if(d.cpu>80) alertMsg("High CPU detected");

 cpuData.push(d.cpu);
 if(cpuData.length>20) cpuData.shift();
 cpuChart.data.labels=cpuData.map((_,i)=>i);
 cpuChart.data.datasets[0].data=cpuData;
 cpuChart.update();

 const hr=await fetch("data/history/"+p+".json");
 const hist=await hr.json();

 costData=hist.map(x=>x.cost);
 instData=hist.map(x=>x.instances);

 costChart.data.labels=costData.map((_,i)=>i);
 costChart.data.datasets[0].data=costData;
 costChart.update();

 scaleCostChart.data.labels=instData.map((_,i)=>i);
 scaleCostChart.data.datasets[0].data=instData;
 scaleCostChart.update();
}

const cpuChart=new Chart(document.getElementById("cpuChart"),
{type:"line",data:{labels:[],datasets:[{label:"CPU %",data:[],borderColor:"red"}]}});

const costChart=new Chart(document.getElementById("costChart"),
{type:"line",data:{labels:[],datasets:[{label:"Cost Trend",data:[],borderColor:"blue"}]}});

const scaleCostChart=new Chart(document.getElementById("scaleCostChart"),
{type:"line",data:{labels:[],datasets:[{label:"Instances",data:[],borderColor:"green"}]}});

setInterval(loadData,10000);
loadProjects();
</script>

</body>
</html>