<!DOCTYPE html>
<html>
<head>
<title>Cloud Cost-Aware Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    font-family: Arial;
    background: #f4f6f9;
    margin: 20px;
}

/* Titles */
h1, h2 {
    color: #333;
}

/* Alert */
.alert {
    background: #ffeeba;
    border-left: 6px solid #ff9800;
    padding: 12px;
    border-radius: 6px;
    margin-bottom: 15px;
    display: none;
}

/* Cards */
.container {
    display: flex;
    flex-wrap: wrap;
}

.card {
    background: white;
    padding: 15px;
    margin: 10px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    width: 230px;
}

/* Charts */
canvas {
    max-width: 900px;
    margin-bottom: 40px;
}
</style>
</head>

<body>

<h1>Cloud Cost-Aware Deployment Dashboard</h1>

<div id="alertBox" class="alert"></div>

<h2>Select Project</h2>
<select id="projectSelect" onchange="loadData()"></select>

<h2>System Overview</h2>
<div class="container">
<div class="card"><p id="cpu"></p></div>
<div class="card"><p id="memory"></p></div>
<div class="card"><p id="instances"></p></div>
<div class="card"><p id="traffic"></p></div>
</div>

<h2>Deployment Details</h2>
<div class="container">
<div class="card"><p id="region"></p></div>
<div class="card"><p id="bestRegion"></p></div>
<div class="card"><p id="saving"></p></div>
<div class="card"><p id="status"></p></div>
</div>

<h2>CPU Usage Trend</h2>
<canvas id="cpuChart"></canvas>

<h2>Cost Trend</h2>
<canvas id="costChart"></canvas>

<h2>Instance Scaling Trend</h2>
<canvas id="instanceChart"></canvas>

<script>
let cpuHistory=[];
let costHistory=[];
let instHistory=[];
let prevCost=null;

/* ---------- Alerts ---------- */
function showAlert(msg){
    const box=document.getElementById("alertBox");
    box.innerHTML=msg;
    box.style.display="block";
}

function clearAlert(){
    document.getElementById("alertBox").style.display="none";
}

/* ---------- Load Projects ---------- */
async function loadProjects(){
    const res=await fetch("data/projects.json");
    const projects=await res.json();

    const sel=document.getElementById("projectSelect");
    sel.innerHTML="";

    projects.forEach(p=>{
        let o=document.createElement("option");
        o.value=p;
        o.text=p;
        sel.appendChild(o);
    });

    loadData();
}

/* ---------- Load Dashboard Data ---------- */
async function loadData(){
    const project=document.getElementById("projectSelect").value;

    const res=await fetch("data/"+project+".json");
    const data=await res.json();

    document.getElementById("cpu").innerText=
        "CPU Usage: "+data.cpu+"%";

    document.getElementById("memory").innerText=
        "Memory Usage: "+data.memory+"%";

    document.getElementById("instances").innerText=
        "Active Instances: "+data.instances;

    document.getElementById("traffic").innerText=
        "Traffic Load: "+data.traffic;

    document.getElementById("region").innerText=
        "Current Region: "+data.current_region;

    document.getElementById("bestRegion").innerText=
        "Best Region: "+data.best_region;

    document.getElementById("saving").innerText=
        "Savings: $"+data.savings.toFixed(4)+"/hr";

    document.getElementById("status").innerText=
        "Status: "+data.status;

    /* Alerts */
    clearAlert();

    if(data.cpu>80)
        showAlert("High CPU usage detected");

    if(prevCost && data.current_price > prevCost*1.1)
        showAlert("Cost spike detected");

    if(data.best_region !== data.current_region)
        showAlert("Migration recommended to cheaper region");

    prevCost=data.current_price;

    /* CPU trend */
    cpuHistory.push(data.cpu);
    if(cpuHistory.length>20) cpuHistory.shift();

    cpuChart.data.labels=cpuHistory.map((_,i)=>i);
    cpuChart.data.datasets[0].data=cpuHistory;
    cpuChart.update();

    /* History file */
    const histRes=
        await fetch("data/history/"+project+".json");
    const hist=await histRes.json();

    costHistory=hist.map(x=>x.cost);
    instHistory=hist.map(x=>x.instances);

    costChart.data.labels=costHistory.map((_,i)=>i);
    costChart.data.datasets[0].data=costHistory;
    costChart.update();

    instanceChart.data.labels=instHistory.map((_,i)=>i);
    instanceChart.data.datasets[0].data=instHistory;
    instanceChart.update();
}

/* ---------- Charts ---------- */
const cpuChart=new Chart(
document.getElementById("cpuChart"),
{type:"line",
data:{labels:[],
datasets:[{label:"CPU %",data:[],borderColor:"red"}]}});

const costChart=new Chart(
document.getElementById("costChart"),
{type:"line",
data:{labels:[],
datasets:[{label:"Cost Trend",data:[],borderColor:"blue"}]}});

const instanceChart=new Chart(
document.getElementById("instanceChart"),
{type:"line",
data:{labels:[],
datasets:[{label:"Instances",data:[],borderColor:"green"}]}});

setInterval(loadData,10000);
loadProjects();
</script>

</body>
</html>