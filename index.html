<html>
<head>
<title>Real AWS Cost Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Refresh page every 10 seconds -->
<meta http-equiv="refresh" content="10">
</head>

<body>

<h1>Real AWS Cost Dashboard</h1>

<h2>Deployment Details</h2>
<p id="region"></p>
<p id="best"></p>
<p id="saving"></p>
<p id="status"></p>

<h2>Server Usage</h2>
<p id="cpu"></p>
<p id="mem"></p>

<h2>CPU Live Graph</h2>
<canvas id="cpuChart"></canvas>

<h2>Memory Live Graph</h2>
<canvas id="memChart"></canvas>

<script>
let cpuData = [];
let memData = [];

async function loadData(){
    const res = await fetch("data.json");
    const data = await res.json();

    document.getElementById("region").innerText =
        "Current Region: " + data.current_region +
        " ($" + data.current_price.toFixed(5) + "/hour)";

    document.getElementById("best").innerText =
        "Best Region: " + data.best_region +
        " ($" + data.best_price.toFixed(5) + "/hour)";

    document.getElementById("saving").innerText =
        "Savings: $" + data.savings.toFixed(5) + "/hour";

    document.getElementById("status").innerText =
        "Migration Status: " + data.status;

    document.getElementById("cpu").innerText =
        "CPU Usage: " + data.cpu + "%";

    document.getElementById("mem").innerText =
        "Memory Usage: " + data.memory + "%";

    /* CPU Graph update */
    cpuData.push(data.cpu);
    if(cpuData.length > 20) cpuData.shift();

    cpuChart.data.labels = cpuData.map((_,i)=>i);
    cpuChart.data.datasets[0].data = cpuData;
    cpuChart.update();

    /* Memory Graph update */
    memData.push(data.memory);
    if(memData.length > 20) memData.shift();

    memChart.data.labels = memData.map((_,i)=>i);
    memChart.data.datasets[0].data = memData;
    memChart.update();
}

/* CPU Chart */
const cpuCtx = document.getElementById('cpuChart').getContext('2d');
const cpuChart = new Chart(cpuCtx, {
    type: 'line',
    data: {
        labels: [],
        datasets: [{
            label: 'CPU %',
            data: [],
            borderColor: 'red',
            fill: false
        }]
    }
});

/* Memory Chart */
const memCtx = document.getElementById('memChart').getContext('2d');
const memChart = new Chart(memCtx, {
    type: 'line',
    data: {
        labels: [],
        datasets: [{
            label: 'Memory %',
            data: [],
            borderColor: 'blue',
            fill: false
        }]
    }
});

/* Load data every 10 seconds */
setInterval(loadData, 10000);
loadData();
</script>

</body>
</html>
