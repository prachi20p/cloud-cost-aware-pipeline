<!DOCTYPE html>
<html>
<head>
<title>Cloud Cost-Aware Deployment Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    font-family: Arial;
    background: #eef1f5;
    margin: 20px;
}

h1 { color: #333; }

.section { margin-bottom: 30px; }

.card {
    background: white;
    padding: 15px;
    margin: 10px;
    border-radius: 10px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    display: inline-block;
    width: 250px;
    vertical-align: top;
    transition: 0.2s;
}

.card:hover { transform: scale(1.02); }

.good { border-left: 6px solid #28a745; }
.warn { border-left: 6px solid #ffc107; }
.bad  { border-left: 6px solid #dc3545; }

canvas {
    max-width: 950px;
    margin-bottom: 40px;
}

.instances span {
    font-size: 24px;
    margin-right: 4px;
}
</style>
</head>

<body>

<h1>Cloud Cost-Aware Deployment Dashboard</h1>

<h2>Select Project</h2>
<select id="projectSelect" onchange="loadData()"></select>

<!-- ---------- Overview ---------- -->
<div class="section">
<h2>System Overview</h2>

<div class="card good"><p id="cpu"></p></div>
<div class="card good"><p id="mem"></p></div>
<div class="card good"><p id="instances"></p></div>
<div class="card good"><p id="traffic"></p></div>

</div>

<!-- ---------- Deployment ---------- -->
<div class="section">
<h2>Deployment Details</h2>

<div class="card"><p id="region"></p></div>
<div class="card"><p id="cheapest"></p></div>
<div class="card"><p id="saving"></p></div>
<div class="card"><p id="status"></p></div>

</div>

<!-- ---------- Comparison ---------- -->
<h2>Project Comparison</h2>
<div id="comparison"></div>

<h3 id="totalCost"></h3>

<!-- ---------- Charts ---------- -->
<h2>CPU Usage Trend</h2>
<canvas id="cpuChart"></canvas>

<h2>Memory Usage Trend</h2>
<canvas id="memChart"></canvas>

<h2>Scaling Trend</h2>
<canvas id="scaleChart"></canvas>

<h2>CPU History Analytics</h2>
<canvas id="cpuHistory"></canvas>

<script>
let cpuData = [];
let memData = [];
let scaleData = [];

/* ---------- Load Projects ---------- */
async function loadProjects(){
    const res = await fetch("data/projects.json");
    const projects = await res.json();

    const select = document.getElementById("projectSelect");
    select.innerHTML = "";

    projects.forEach(p => {
        const opt = document.createElement("option");
        opt.value = p;
        opt.text = p;
        select.appendChild(opt);
    });

    loadData();
    loadComparison();
}

/* ---------- Load Data ---------- */
async function loadData(){
    const project =
        document.getElementById("projectSelect").value;

    const res = await fetch("data/" + project + ".json");
    const data = await res.json();

    /* Deployment info */
    document.getElementById("region").innerText =
        "Current Region: " + data.current_region +
        " ($" + data.current_price + "/hr)";

    document.getElementById("cheapest").innerText =
        "Best Region: " + data.best_region +
        " ($" + data.best_price + "/hr)";

    document.getElementById("saving").innerText =
        "Savings: $" + data.savings + "/hr";

    document.getElementById("status").innerText =
        "Status: " + data.status;

    /* Overview cards */
    document.getElementById("cpu").innerText =
        "CPU Usage: " + data.cpu + "%";

    document.getElementById("mem").innerText =
        "Memory Usage: " + data.memory + "%";

    document.getElementById("traffic").innerText =
        "Traffic Load: " + data.traffic;

    /* Instance icons */
    let icons = "";
    for(let i=0;i<data.instances;i++)
        icons += "ðŸ–¥ï¸";

    document.getElementById("instances").innerHTML =
        "Instances:<div class='instances'>" + icons + "</div>";

    /* Status coloring */
    let cpuCard =
        document.getElementById("cpu").parentElement;

    cpuCard.classList.remove("good","warn","bad");

    if(data.cpu > 75)
        cpuCard.classList.add("bad");
    else if(data.cpu > 55)
        cpuCard.classList.add("warn");
    else
        cpuCard.classList.add("good");

    /* Live CPU graph */
    cpuData.push(data.cpu);
    if(cpuData.length > 20) cpuData.shift();

    cpuChart.data.labels = cpuData.map((_,i)=>i);
    cpuChart.data.datasets[0].data = cpuData;
    cpuChart.update();

    /* Memory graph */
    memData.push(data.memory);
    if(memData.length > 20) memData.shift();

    memChart.data.labels = memData.map((_,i)=>i);
    memChart.data.datasets[0].data = memData;
    memChart.update();

    /* Scaling graph */
    scaleData.push(data.instances);
    if(scaleData.length > 20) scaleData.shift();

    scaleChart.data.labels = scaleData.map((_,i)=>i);
    scaleChart.data.datasets[0].data = scaleData;
    scaleChart.update();

    /* History analytics */
    const histRes =
        await fetch("data/history/" + project + ".json");

    const hist = await histRes.json();

    const cpuHistory = hist.map(x => x.cpu);

    historyChart.data.labels =
        cpuHistory.map((_,i)=>i);

    historyChart.data.datasets[0].data =
        cpuHistory;

    historyChart.update();
}

/* ---------- Comparison ---------- */
async function loadComparison(){
    const res = await fetch("data/projects.json");
    const projects = await res.json();

    let html = "";
    let total = 0;

    for(const p of projects){
        const r = await fetch("data/" + p + ".json");
        const d = await r.json();

        total += d.current_price;

        html += `
        <div class="card">
            <b>${p}</b><br>
            Region: ${d.current_region}<br>
            Cost/hr: $${d.current_price.toFixed(4)}<br>
            Instances: ${d.instances}<br>
            Status: ${d.status}
        </div>`;
    }

    document.getElementById("comparison").innerHTML = html;

    document.getElementById("totalCost").innerText =
        "Total hourly cost across projects: $" +
        total.toFixed(4);
}

/* ---------- Charts ---------- */
const cpuChart = new Chart(
    document.getElementById("cpuChart"),
    {
        type: "line",
        data: { labels: [], datasets: [{ label: "CPU %", data: [], borderColor: "red" }] }
    }
);

const memChart = new Chart(
    document.getElementById("memChart"),
    {
        type: "line",
        data: { labels: [], datasets: [{ label: "Memory %", data: [], borderColor: "blue" }] }
    }
);

const scaleChart = new Chart(
    document.getElementById("scaleChart"),
    {
        type: "line",
        data: { labels: [], datasets: [{ label: "Instances", data: [], borderColor: "green" }] }
    }
);

const historyChart = new Chart(
    document.getElementById("cpuHistory"),
    {
        type: "line",
        data: { labels: [], datasets: [{ label: "CPU History", data: [], borderColor: "purple" }] }
    }
);

/* ---------- Auto Refresh ---------- */
setInterval(loadData, 10000);
loadProjects();

</script>

</body>
</html>